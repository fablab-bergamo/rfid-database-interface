function validateElement(n,t){$("#loader").hide();var i=document.getElementById(n);return i.checkValidity()==!1?($("#"+t).text(" Check the "+i.name+" field. "+i.validationMessage),!0):!1}function diffPasswords(n,t,i){$("#loader").hide();var n=$("#"+n).val(),t=$("#"+t).val();return n==t?($("#"+i).text("Please make sure the old and new passwords are different and try again."),!0):!1}function samePasswords(n,t,i){$("#loader").hide();var n=$("#"+n).val(),t=$("#"+t).val();return n!=t?($("#"+i).text("Please make sure the passwords are the same and try again."),!0):!1}function pauseButton(n,t,i){var r=$("#"+n).val();$("#"+n).attr("value",t+" ("+i/1e3+" secs)");$("#"+n).attr("disabled",!0);setTimeout(function(){$("#"+n).attr("value",r);$("#"+n).attr("disabled",!1)},i)}function timedCount(){var i;try{var r=jwt_decode(user.accesstoken),u=r.exp,n=new Date(0),t=new Date(0);n.setUTCSeconds(u);t.setUTCSeconds((new Date).getTime()/1e3);i=new Date(t.getTime()+6e4);showConsole&&console.log("Check if access token is about to expire.");n<i&&(showConsole&&console.log("Access token is about to expire, so refresh it."),refreshAccessToken())}catch(f){showConsole&&console.log("Access token check error...logging out...");logoutButton()}finally{timer_is_on&&(timer_proxy=setTimeout(timedCount,15e3))}}function startCount(){timer_is_on||(showConsole&&console.log("Start authentication timer."),timer_is_on=1,timedCount())}function stopCount(){clearTimeout(timer_proxy);timer_is_on=0;showConsole&&console.log("Stop authentication timer.")}function openRegisterDialog(){closeWindows();$("#register-dialog").dialog("open")}function openLoginDialog(){closeWindows();$("#login-dialog").dialog("open")}function openForgotDialog(){closeWindows();$("#forgot-dialog").dialog("open")}function openResetDialog(){closeWindows();$("#reset-dialog").dialog("open")}function openIdentityDialog(){closeWindows();$("#identity-dialog").dialog("open")}function openIdentityDeleteDialog(){closeWindows();$("#identity-delete-dialog").dialog("open")}function openPlantUmlServerDialog(){closeWindows();$("#plantumlserver-dialog").dialog("open")}function closeWindows(){$("#settings-dialog").dialog("close");$("#news-dialog").dialog("close");$("#login-dialog").dialog("close");$("#register-dialog").dialog("close");$("#forgot-dialog").dialog("close");$("#identity-dialog").dialog("close");$("#identity-delete-dialog").dialog("close");$("#reset-dialog").dialog("close");$("#scripting-dialog").dialog("close");$("#plantumlserver-dialog").dialog("close");$("#sendtoemail-dialog").dialog("close");$("#webhook-dialog").dialog("close")}function clearMessages(){$("#login-message").text("");$("#register-message").text("");$("#forgot-message").text("");$("#identity-message").text("");$("#identity-delete-message").text("");$("#reset-message").text("");$("#sendtoemail-message").text("");$("#webhook-message").text("");$("#file-menu-new-message").text("");$("#file-menu-open-message").text("");$("#file-menu-saveas-message").text("")}function loginButton(){pauseButton("login-button","Paused",2e3);$("#loader").show();var n="";(clearMessages(),validateElement("login-email","login-message"))||validateElement("login-password","login-message")||$.ajax({type:"POST",url:"api/auth/login",timeout:2e4,dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify({Email:$("#login-email").val(),Password:$("#login-password").val()}),success:function(t){t.Success==!1?($("#login-password").val(""),$("#login-message").text(t.Message)):(user={email:t.Email,firstname:t.FirstName,lastname:t.LastName,accesstoken:t.AccessToken,refreshtoken:t.RefreshToken,refreshtokenexpirytime:t.RefreshTokenExpiryTime,role:t.Role},n="Welcome "+user.firstname+" "+user.lastname+". You have been logged in!",$("#login-link").hide(),$("#scripting-link").show(),$("#plantumlserver-link").show(),$("#email-link").show(),$("#webhook-link").show(),$("#identity-link").show(),$("#logout-link").show(),startCount(),$("#welcome-text-label").text(user.firstname+" "+user.lastname),$("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3),$("#login-password").val(""),$("#login-dialog").dialog("close"));$("#loader").hide()},error:function(){console.log("An error occured during login. Please contact admin@planttext.com.");$("#loader").hide()}})}function forgotButton(){$("#forgot-button").attr("value","Disabled (Close Window)");$("#forgot-button").attr("disabled",!0);$("#loader").show();var n="";(clearMessages(),validateElement("forgot-email","forgot-message"))||$.ajax({type:"POST",url:"api/auth/forgot",timeout:5e4,dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify({Email:$("#forgot-email").val()}),success:function(t){n=t.Message;t.Success?($("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3),$("#forgot-message").text(n),$("#forgot-button").attr("disabled",!0)):($("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3),$("#forgot-message").text(n),$("#forgot-button").attr("disabled",!1));$("#loader").hide()},error:function(){console.log("An error occured during forgot password. Please contact admin@planttext.com.");$("#loader").hide()}})}function resetButton(){pauseButton("reset-button","Paused",2e3);$("#loader").show();var n="";(clearMessages(),samePasswords("reset-password-new1","reset-password-new2","reset-message"))||validateElement("reset-email","reset-message")||validateElement("reset-password-new1","reset-message")||validateElement("reset-password-new2","reset-message")||$.ajax({type:"POST",url:"api/auth/reset",timeout:5e4,dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify({Email:$("#reset-email").val(),Password:$("#reset-password-new1").val(),Password2:$("#reset-password-new2").val(),Guid:resetToken}),success:function(t){n=t.Message;t.Success?($("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3),$("#reset-message").text(n),$("#reset-dialog").dialog("close"),$("#login-dialog").dialog("open")):($("#reset-message").text(n),$("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3));resetToken="";$("#loader").hide()},error:function(){console.log("An error occured during password reset. Please contact admin@planttext.com.");$("#loader").hide()}})}function refreshAccessToken(){$.ajax({type:"POST",url:"api/token/refresh",timeout:5e3,headers:{Authorization:"Bearer "+user.accesstoken},dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify({AccessToken:user.accesstoken,RefreshToken:user.refreshtoken}),success:function(n){n.Success==!1?(showConsole&&console.log(n.Message),logoutButton()):(showConsole&&console.log("Got a new access token."),user={email:n.Email,firstname:n.FirstName,lastname:n.LastName,accesstoken:n.AccessToken,refreshtoken:n.RefreshToken,refreshtokenexpirytime:n.RefreshTokenExpiryTime,role:n.Role})},error:function(){console.log("An error occured while refreshing token. Please contact admin@planttext.com.")}})}function logoutButton(){stopCount();clearMessages();closeWindows();$("#loader").show();$("#login-link").show();$("#scripting-link").hide();$("#plantumlserver-link").hide();$("#email-link").hide();$("#webhook-link").hide();$("#identity-link").hide();$("#logout-link").hide();$("#welcome-text-label").text("");var n="";$.ajax({type:"GET",url:"api/token/revoke",timeout:5e3,headers:{Authorization:"Bearer "+user.accesstoken},success:function(){user=null;n="You have been logged out from the server.";$("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3);showConsole&&console.log(n);$("#loader").hide()},error:function(){console.log("An error occured during logout. Please contact admin@planttext.com.");$("#loader").hide()}})}function logoutButtonNoRevoke(){user=null;stopCount();clearMessages();closeWindows();$("#login-link").show();$("#scripting-link").hide();$("#plantumlserver-link").hide();$("#email-link").hide();$("#webhook-link").hide();$("#identity-link").hide();$("#logout-link").hide()}function registerButton(){if(!samePasswords("register-password","register-password2","register-message")&&!validateElement("register-firstname","register-message")&&!validateElement("register-lastname","register-message")&&!validateElement("register-email","register-message")&&!validateElement("register-password","register-message")&&!validateElement("register-password2","register-message")){$("#register-button").attr("value","Disabled (Close Window)");$("#register-button").attr("disabled",!0);$("#loader").show();var n="";clearMessages();$.ajax({type:"POST",url:"api/register",timeout:5e4,dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify({FirstName:$("#register-firstname").val(),LastName:$("#register-lastname").val(),Email:$("#register-email").val(),Password:$("#register-password").val(),Password2:$("#register-password2").val()}),success:function(t){n=t.Message;t.Success?($("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3),$("#register-message").text(n),$("#login-dialog").dialog("close")):($("#register-message").text(n),$("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3));$("#loader").hide()},error:function(){console.log("An error occured during registration. Please contact admin@planttext.com.");$("#loader").hide()}})}}function identityUpdateButton(){var n;pauseButton("identity-button","Paused",1e3);$("#loader").show();n="";clearMessages();var t=$("#identity-password").val().trim(),i=$("#identity-password-new1").val().trim(),r=$("#identity-password-new2").val().trim();if(!validateElement("identity-firstname","identity-message")&&!validateElement("identity-lastname","identity-message"))if(t==""&&i==""&&r=="")$.ajax({type:"PUT",url:"api/identity",timeout:5e4,headers:{Authorization:"Bearer "+user.accesstoken},dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify({Email:$("#identity-email").text(),FirstName:$("#identity-firstname").val(),LastName:$("#identity-lastname").val(),Password:"",Password2:""}),success:function(t){t&&(user.firstname=$("#identity-firstname").val(),user.lastname=$("#identity-lastname").val(),n="Profile modified "+t.FirstName+".",$("#welcome-text-label").text(user.firstname+" "+user.lastname),$("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3),$("#identity-dialog").dialog("close"));$("#loader").hide()},error:function(){console.log("An error occured during identity update without password. Please contact admin@planttext.com.");$("#loader").hide()}});else{if(validateElement("identity-password","identity-message"))return;if(validateElement("identity-password-new1","identity-message"))return;if(validateElement("identity-password-new2","identity-message"))return;if(samePasswords("identity-password-new1","identity-password-new2","identity-message"))return;if(diffPasswords("identity-password","identity-password-new2","identity-message"))return;$.ajax({type:"PUT",url:"api/identity",timeout:5e4,headers:{Authorization:"Bearer "+user.accesstoken},dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify({Email:$("#identity-email").text(),FirstName:$("#identity-firstname").val(),LastName:$("#identity-lastname").val(),Password:$("#identity-password").val(),Password2:$("#identity-password-new2").val()}),success:function(t){t&&(logoutButton(),n="Profile modified "+t.FirstName+". Now please login again.",$("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3),$("#identity-dialog").dialog("close"),$("#login-dialog").dialog("open"));$("#loader").hide()},error:function(){console.log("An error occured during identity update with password. Please contact admin@planttext.com.");$("#loader").hide()}})}}function identityDeleteProfileButton(){var t=confirm('This will delete your user profile. Your settings and diagrams will be left in local storage. Press "Ok" to coninue or "Cancel" to abort.',"Delete Local Storage"),n;t&&(pauseButton("identity-delete-profile","Paused",2e3),$("#loader").show(),n="",$.ajax({type:"DELETE",url:"api/identity",timeout:5e4,headers:{Authorization:"Bearer "+user.accesstoken},dataType:"json",contentType:"application/json",processData:!1,success:function(t){logoutButtonNoRevoke();t&&(n="Your profile has been deleted "+t.FirstName+".",$("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3),$("#identity-delete-dialog").dialog("close"));$("#loader").hide()},error:function(){console.log("An error occured while deleting server profile. Please contact admin@planttext.com.");$("#loader").hide()}}))}function identityDeleteLocalStorageButton(){var n=confirm('This will delete all PlantText data including all diagrams! Press "Ok" to coninue or "Cancel" to abort.',"Delete Local Storage"),t;n&&(pauseButton("identity-delete-local","Paused",1e3),$("#loader").show(),t="",clearMessages(),localStorage.clear(),$("#loader").hide(),window.location.reload(!0))}function savePlantUmlServerFromButton(){if(pauseButton("plantumlserversave-button","Paused",1e3),$("#loader").show(),typeof Storage!="undefined"){var n=document.getElementById("plantumlserver").value;n==""?localStorage.setItem("planttext_plantumlserver","default"):localStorage.setItem("planttext_plantumlserver",n)}$("#loader").hide();$("#fademessage").css("color","black").css("background-color","white").html("Your PlantUML Server has been saved to the local cache.").fadeIn(1).fadeOut(5e3);$("#settings-dialog").dialog("close")}function defaultFromButton(){document.getElementById("plantumlserver").value="";$("#fademessage").css("color","black").css("background-color","white").html("The PlantUML server is now set to the defalt.").fadeIn(1).fadeOut(5e3)}function openSendToEmailDialog(){$("#sendtoemail-dialog").dialog("open")}function sendToEmailSubmitButton(){pauseButton("sendtoemail-button","Paused",5e3);var t="",i=document.getElementById("description").value,r=encode64(deflate(unescape(encodeURIComponent(i)))),n=document.getElementById("plantumlserver").value;n=n.trim()==""?location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/api/plantuml/":n.endsWith("/")?n:n.concat("/");$.ajax({type:"POST",url:"api/send",timeout:5e4,headers:{Authorization:"Bearer "+user.accesstoken},dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify({Name:$("#sendtoemail-name").val(),PlantUmlServer:n,ImageType:$("#sendtoemail-imagetype").val(),Diagram:r}),success:function(n){n&&(t=n.Message,n.Success&&$("#fademessage").css("color","green").css("background-color","white").html(t).fadeIn(1).fadeOut(5e3),$("#sendtoemail-dialog").dialog("close"));$("#loader").hide()},error:function(){console.log("An error occured while sending diagram via email. Please contact admin@planttext.com.");$("#loader").hide()}})}function getWebhookData(){var f=document.getElementById("description").value,r=encode64(deflate(unescape(encodeURIComponent(f)))),n=document.getElementById("plantumlserver").value,t,i,u;n=n.trim()==""?location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/api/plantuml/":n.endsWith("/")?n:n.concat("/");t="";i=$("#webhook-imagetype").val();i=="png"?t=n+"img/"+r:i=="svg"?t=n+"svg/"+r:i=="txt"?t=n+"txt/"+r:i=="edit"&&(t=n+"/?text="+r);u={Name:$("#webhook-name").val(),UrlType:i,WebHook:$("#webhook-hook").val(),DiagramUrl:t};$("#webhook-request").val(JSON.stringify(u,undefined,6))}function openWebhookDialog(){var n,t;$("#webhook-dialog").dialog("open");typeof Storage!="undefined"&&(n=localStorage.getItem("planttext_webhook"),$("#webhook-hook").val(n),t=localStorage.getItem("planttext_webhooktype"),$("#webhook-imagetype option[value='"+t+"']").attr("selected",!0));getWebhookData();$("#webhook-hook").keyup(function(){getWebhookData()});$("#webhook-imagetype").change(function(){getWebhookData()});$("#webhook-name").keyup(function(){getWebhookData()})}function webhookUrlSave(){$("#loader").show();typeof Storage!="undefined"&&(localStorage.setItem("planttext_webhook",document.getElementById("webhook-hook").value),localStorage.setItem("planttext_webhooktype",document.getElementById("webhook-imagetype").value));$("#loader").hide();$("#fademessage").css("color","black").css("background-color","white").html("Your Webhook URL has been saved to the local cache.").fadeIn(1).fadeOut(5e3)}function webhookSubmitButton(){pauseButton("webhook-button","Paused",5e3);webhookUrlSave();var u=document.getElementById("description").value,i=encode64(deflate(unescape(encodeURIComponent(u)))),f=$("#webhook-name").val(),n=$("#webhook-imagetype").val(),e=$("#webhook-hook").val(),r="",t=document.getElementById("plantumlserver").value;r=n=="edit"?location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/?text="+i:t.trim()==""?location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/api/plantuml/"+n+"/"+i:t.endsWith("/")?t:t.concat("/")+n+"/"+i;$.ajax({type:"POST",url:"api/webhook",timeout:5e4,headers:{Authorization:"Bearer "+user.accesstoken},dataType:"json",contentType:"application/json",processData:!1,data:JSON.stringify({Name:f,UrlType:n,WebHook:e,DiagramUrl:r}),success:function(n){n?($("#webhook-response").val(JSON.stringify(n,undefined,6)),$("#fademessage").css("color","green").css("background-color","white").html(n).fadeIn(1).fadeOut(5e3)):$("#webhook-response").val(n);$("#loader").hide()},error:function(){console.log("An error occured while sending diagram via webhook. Please contact admin@planttext.com.");$("#loader").hide()}})}function toggleNewspop(){typeof Storage!="undefined"&&document.getElementById("newpopstop").checked&&localStorage.setItem("planttext_message",news_version)}function openNewsDialog(){$("#login-dialog").dialog("isOpen")||$("#reset-dialog").dialog("isOpen")||$("#register-dialog").dialog("isOpen")||$.ajax({type:"GET",url:"api/news/"+news_version,timeout:5e3,success:function(n){$("#newsitem").html(n.Content);$("#news-dialog").dialog("open")},error:function(){console.log("An error occured while opening news dialog. Please contact admin@planttext.com.");$("#loader").hide()}})}function LoadAllSamples(){$("#loader").show();$.ajax({type:"GET",url:"api/samples",timeout:5e3,success:function(n){for(var u,f,i=$("#samples"),r=n[0].Category,e=$(document.createElement("optgroup")).attr("value",r).attr("label",r).appendTo(i),t=0;t<n.length;t++)f=n[t].Category,f===r?u=$(document.createElement("option")).attr("value",n[t].Id).text(n[t].Name).appendTo(i):(u=$(document.createElement("optgroup")).attr("value",n[t].Id).attr("label",n[t].Category).appendTo(i),u=$(document.createElement("option")).attr("value",n[t].Id).text(n[t].Name).appendTo(i)),r=n[t].Category;$("#loader").hide()},error:function(){console.log("An error occured while loading all samples. Please contact admin@planttext.com.");$("#loader").hide()}})}function settingsSaveButton(){pauseButton("settingssave-button","Paused",1e3);$("#loader").show();typeof Storage!="undefined"&&(localStorage.setItem("planttext_layout",$("input[name='layout']:checked").val()),localStorage.setItem("planttext_theme",document.getElementById("theme").value),localStorage.setItem("planttext_keybinding",document.getElementById("keybinding").value),localStorage.setItem("planttext_fontsize",document.getElementById("fontsize").value),localStorage.setItem("planttext_usesofttabs",document.getElementById("usesofttabs-checkbox").checked),localStorage.setItem("planttext_tabsize",document.getElementById("tabsize-dropdown").value),localStorage.setItem("planttext_invisibles",document.getElementById("invisibles").checked),localStorage.setItem("planttext_indentguide",document.getElementById("indentguide").checked),localStorage.setItem("planttext_highlightactiveline",document.getElementById("highlightactiveline-checkbox").checked),localStorage.setItem("planttext_showprintmargin",document.getElementById("showprintmargin-checkbox").checked),localStorage.setItem("planttext_showscratch",document.getElementById("showscratch-checkbox").checked),localStorage.setItem("planttext_usewrapmode",document.getElementById("usewrapmode-checkbox").checked),localStorage.setItem("planttext_syntaxhighlight",document.getElementById("syntaxhighlighting-checkbox").checked));$("#loader").hide();$("#fademessage").css("color","black").css("background-color","white").html("Your settings have been saved to the local cache.").fadeIn(1).fadeOut(5e3);$("#settings-dialog").dialog("close")}function settingsDefaultButton(){pauseButton("settingsdefault-button","Paused",1e3);$("#loader").show();$("#layout-portrait").attr("checked","checked");portrait();$("#theme option[value='textmate']").attr("selected",!0);editor.setTheme("ace/theme/textmate");$("#keybinding option[value='ace']").attr("selected",!0);editor.setKeyboardHandler("ace/keyboard/ace");$("#fontsize option[value='12']").attr("selected",!0);editor.setFontSize("12px");$("#usesofttabs-checkbox").attr("checked","checked");editor.session.setUseSoftTabs(!0);$("#tabsize-dropdown option[value='2']").attr("selected",!0);editor.session.setTabSize(2);$("#invisibles").attr("checked","checked");editor.setShowInvisibles(!0);$("#indentguide").attr("checked","checked");editor.setDisplayIndentGuides(!0);$("#highlightactiveline-checkbox").attr("checked","checked");editor.setHighlightActiveLine(!0);$("#showprintmargin-checkbox").attr("checked","checked");editor.setShowPrintMargin(!0);$("#showscratch-checkbox").removeAttr("checked");$('textarea[name="scratch-textarea"]').hide();$("#scratchblock").css("border","0px solid");$("#usewrapmode-checkbox").removeAttr("checked");editor.session.setUseWrapMode(!1);$("#syntaxhighlighting-checkbox").removeAttr("checked");editor.getSession().setMode("ace/mode/diagram");$("#loader").hide();$("#fademessage").css("color","black").css("background-color","white").html("Your settings have been set to defaults.").fadeIn(1).fadeOut(5e3)}function toggleVisibles(){editor.getShowInvisibles()==!1?editor.setShowInvisibles(!0):editor.setShowInvisibles(!1)}function toggleIndentGuide(){editor.getDisplayIndentGuides()==!1?editor.setDisplayIndentGuides(!0):editor.setDisplayIndentGuides(!1)}function toggleShowScratchCheckbox(){$('textarea[name="scratch-textarea"]').is(":hidden")?($('textarea[name="scratch-textarea"]').show(),$("#scratchblock").css("border","1px solid")):($('textarea[name="scratch-textarea"]').hide(),$("#scratchblock").css("border","0px solid"))}function toggleSyntaxHighlightingCheckbox(){editor.getSession().getMode().$id=="ace/mode/text"?editor.getSession().setMode("ace/mode/diagram"):editor.getSession().setMode("ace/mode/text")}function toggleUseSoftTabsCheckbox(){editor.session.getUseSoftTabs()==!1?editor.session.setUseSoftTabs(!0):editor.session.setUseSoftTabs(!1)}function toggleUseWrapModeCheckbox(){editor.session.getUseWrapMode()==!1?editor.session.setUseWrapMode(!0):editor.session.setUseWrapMode(!1)}function toggleHighlightActiveLineCheckbox(){editor.getHighlightActiveLine()==!1?editor.setHighlightActiveLine(!0):editor.setHighlightActiveLine(!1)}function toggleShowPrintMarginCheckbox(){editor.getShowPrintMargin()==!1?editor.setShowPrintMargin(!0):editor.setShowPrintMargin(!1)}function ptq(n){var u=n.replace(/;/g,"&").split("&"),i,t,r;for(n={},i=0;i<u.length;i++)r=u[i].split("=",2),t=unescape(r[0]),n[t]||(n[t]=[]),n[t][n[t].length]=r.length>1?unescape(r[1]):!0;return n}function param(){return ptq(location.search.substring(1).replace(/\+/g," "))}function entify(n){return(""+n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;").replace(/>/g,"&gt;")}function refreshFromButton(){var t,n;pauseButton("refreshbutton","Paused",2e3);t=document.getElementById("description").value;typeof Storage!="undefined"&&(n=localStorage.getItem("planttext_default"),n!=null&&n!=""&&localStorage.setItem(n,t));compress(t);$("#fademessage").css("color","black").css("background-color","white").html("The diagram is refreshing and your PlantUML has been saved to your computer's local storage.").fadeIn(1).fadeOut(5e3)}function urlFromPlantUML(n,t,i){pauseButton("scriptingbutton","Paused",5e3);var r=document.getElementById(n).value,u=document.getElementById(t).value;$("#loader").show();$.ajax({type:"POST",url:"api/scripting",timeout:5e3,dataType:"text",contentType:"text/plain;charset=UTF-8",processData:!1,data:u,success:function(n){var u="",t=document.getElementById("plantumlserver").value;t.trim()==""?(t=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+"/api/plantuml/",u=t+r+"/"+n):(t=t.endsWith("/")?t:t.concat("/"),u=t+r+"/"+n);u=t+r+"/"+n;document.getElementById(i).value=u;$("#loader").hide();$("#fademessage").css("color","black").css("background-color","white").html("Converting PlantUML to link.").fadeIn(1).fadeOut(5e3)},error:function(){console.log("An error occured while creating a link for diagram. Please contact admin@planttext.com.");$("#loader").hide()}})}function refreshFromSamples(n){editor.getSession().setValue(n);compress(document.getElementById("description").value);resizeEditor()}function resizeBrowser(){var n=$("#layout-landscape").attr("checked");n?landscape():portrait();$("#sidebar").height($(window).height()-sidebar_portrait_h_mod);resizeEditor()}function resizeEditor(){$("#editor").width($("#sidebar").width()-10);$("#editor").height($("#sidebar").height()-45);$("#scratch").height($(window).height()-sidebar_portrait_h_mod-10);$("#scratch").width(sidebar_portrait_w);editor.resize()}function openHelpDialog(){$("#help-dialog").dialog("open")}function openSettingsDialog(){$("#settings-dialog").dialog("open")}function openScriptingDialog(){$("#scripting-dialog").dialog("open")}function openFiles(){$("#files").dialog("open")}function fileNameOutput(){var n=localStorage.getItem("planttext_default");$("#file-name-output").text(n.substring(18))}function openFileMenuNew(){$("#file-menu-new").dialog("open")}function submitFileMenuNew(){var t="",n=$("#file-menu-new-name").val().trim(),e=!1,u,f,r;for(i=0;i<window.localStorage.length;i++)if(u=window.localStorage.key(i),u.substring(0,18)==="planttext_diagram:"&&u.substring(18).trim()==n.trim()){e=!0;break}e?(t="This file name is already in use. Please try another name.",$("#file-menu-new-message").text(t)):n.trim()==""||n.length>=40?(t="Please enter a name that is fewer than 40 characters.",$("#file-menu-new-message").text(t)):n!=null&&(f="@startuml\r\rtitle Empty Diagram\r\r@enduml",r="planttext_diagram:"+n,localStorage.setItem("planttext_default",r),localStorage.setItem(r,f),fileNameOutput(r),refreshFromSamples(f),$("#file-menu-new").dialog("close"))}function submitFileMenuNewCancel(){$("#file-menu-new").dialog("close")}function openFileMenuOpen(){$("#file-menu-open").dialog("open")}function submitFileMenuOpen(){var t="",n=$("#file-menu-open-list").val(),r=localStorage.getItem("planttext_default"),i;n==null?(t="Please select a file to open or close this window.",$("#file-menu-open-message").text(t)):r==n?(t="You have selected the same file that is currently open.",$("#file-menu-open-message").text(t)):(i=localStorage.getItem(n),localStorage.setItem("planttext_default",n),localStorage.setItem(n,i),fileNameOutput(n),refreshFromSamples(i),$("#file-menu-open").dialog("close"))}function submitFileMenuOpenLoad(){var n,t;for($("#file-menu-open-list").html(""),i=0;i<window.localStorage.length;i++)n=localStorage.key(i),n.substring(0,18)==="planttext_diagram:"&&(t=localStorage.getItem(n),$("#file-menu-open-list").append('<option value="'+n+'">'+n.substring(18,n.length)+"<\/option>"))}function submitFileMenuOpenCancel(){$("#file-menu-open").dialog("close")}function submitFileMenuSave(){var n=localStorage.getItem("planttext_default"),t;n==""?alert("No file is currently loaded. Please use Save As to create a new file."):(t=$("#description").val(),typeof Storage!="undefined"?(n=localStorage.getItem("planttext_default"),localStorage.setItem(n,t),$("#fademessage").css("color","black").css("background-color","white").html("The diagram has been saved to your computer's local storage.").fadeIn(1).fadeOut(5e3)):alert("It appears you do not have a local storage capable browser or configuration. Please reolve before trying to use this application"))}function openFileMenuSaveas(){$("#file-menu-saveas").dialog("open")}function submitFileMenuSaveas(){var t="",n=$("#file-menu-saveas-name").val().trim(),e=!1,u,f,r;for(i=0;i<window.localStorage.length;i++)if(u=window.localStorage.key(i),u.substring(0,18)==="planttext_diagram:"&&u.substring(18).trim()==n.trim()){e=!0;break}e?(t="This file name is already in use. Please try another name.",$("#file-menu-saveas-message").text(t)):n.trim()==""||n.length>=40?(t="Please enter a name that is fewer than 40 characters.",$("#file-menu-saveas-message").text(t)):n!=null&&(f=document.getElementById("description").value,r="planttext_diagram:"+n,localStorage.setItem("planttext_default",r),localStorage.setItem(r,f),fileNameOutput(r),refreshFromSamples(f),$("#file-menu-saveas").dialog("close"))}function submitFileMenuSaveasCancel(){$("#file-menu-saveas").dialog("close")}function submitFileMenuDelete(){if(typeof Storage!="undefined"){var n=localStorage.getItem("planttext_default");n==""?alert("No file is currently loaded. Please open the file you wish to delete."):(localStorage.removeItem(n),localStorage.setItem("planttext_default",""),refreshFromSamples("@startuml\r\rtitle Empty Diagram\r\r@enduml"),$("#file-name-output").text(""))}}function openFileMenu(){document.getElementById("file-menu-list").classList.toggle("show")}function unDock(){var n=$(window).width()-($("#sidebar").width()+50);$("#sidebar").draggable();$("#sidebar").css({top:10});$("#sidebar").css({left:+n});$("#content").offset(sidebar_offset);resizeEditor();$("#fademessage").css("color","black").css("background-color","white").html("The editor is now in drag mode. You can move it around to any position on the screen.").fadeIn(1).fadeOut(5e3)}function doDock(){$("#sidebar").draggable("destroy");$("#sidebar").width(sidebar_portrait_w);$("#sidebar").height($(window).height()-sidebar_portrait_h_mod);$("#sidebar").offset(sidebar_offset);$("#sidebar").css({float:"left"});resizeEditor();$("#content").css({float:"left"});$("#content").offset(diagram_offset);$("#fademessage").css("color","black").css("background-color","white").html("The editor is now in dock mode. It will always be docked to the upper left and the diagram will to the right or below it.").fadeIn(1).fadeOut(5e3)}function portrait(){$("#sidebar").height($(window).height()-sidebar_portrait_h_mod);$("#sidebar").width(sidebar_portrait_w);resizeEditor()}function landscape(){$("#sidebar").height($(window).height()/sidebar_landscape_h_mod);$("#sidebar").width($(window).width()-sidebar_landscape_w_mod);resizeEditor()}function importUML(){var i=document.getElementById("fileInput"),t=i.files[0],n;return t.type.match(/text.*/)?(n=new FileReader,n.onload=function(){editor.getSession().setValue(n.result);compress(document.getElementById("description").value)},n.readAsText(t),resizeEditor()):alert("File not supported!"),!1}function exportUML(){return Download.save(editor.getSession().getValue(),"plantuml_export.txt"),!1}var showConsole=!0,news_version=22,sidebar_portrait_w=500,sidebar_portrait_h_mod=180,sidebar_landscape_w_mod=45,sidebar_landscape_h_mod=2,sidebar_offset={top:101,left:13},diagram_offset={top:101,left:535},warn_about_samples=!0,editor=ace.edit("editor"),textarea=$('textarea[name="description"]').hide(),Download;editor.getSession().setValue(textarea.val());editor.getSession().on("change",function(){textarea.val(editor.getSession().getValue())});editor.getSession().setMode("ace/mode/diagram");var user=null,timer_proxy,timer_is_on=0,resetToken="";document.getElementById("theme").onchange=function(){var n=this.options[this.selectedIndex].value;editor.setTheme("ace/theme/"+n)};document.getElementById("fontsize").onchange=function(){var n=this.options[this.selectedIndex].value;editor.setFontSize(n+"px");editor.resize()};document.getElementById("tabsize-dropdown").onchange=function(){var n=this.options[this.selectedIndex].value;editor.session.setTabSize(n);editor.resize()};document.getElementById("keybinding").onchange=function(){var n=this.options[this.selectedIndex].value;n==""?editor.setKeyboardHandler("ace/keyboard/"):editor.setKeyboardHandler("ace/keyboard/"+n)};document.getElementById("samples").onchange=function(){var t=this.options[this.selectedIndex].value,n;t!="default"&&(n=!0,warn_about_samples&&(n=confirm('This will replace the PlantUML you have in your editor window. Press "Ok" to coninue or "Cancel" to abort.',"Samples"),warn_about_samples=!1),n&&($("#loader").show(),$.ajax({type:"GET",url:"api/samples/"+t,timeout:5e3,success:function(n){refreshFromSamples(n.Content);$("#loader").hide()},error:function(){console.log("An error occured while loading a single sample. Please contact admin@planttext.com.");$("#loader").hide()}})))};window.onclick=function(n){var i,t,r;if(!n.target.matches("#file-menu-button"))for(i=document.getElementsByClassName("file-menu-dropdown-content"),t=0;t<i.length;t++)r=i[t],r.classList.contains("show")&&r.classList.remove("show")};Download={click:function(n){var t=document.createEvent("MouseEvents");return t.initMouseEvent("click",!0,!1,self,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(t)},encode:function(n){return"data:application/octet-stream;base64,"+btoa(n)},link:function(n,t){var i=document.createElement("a");return i.download=t||self.location.pathname.slice(self.location.pathname.lastIndexOf("/")+1),i.href=n||self.location.href,i}};Download.save=function(n,t){this.click(this.link(this.encode(n),t))};$(window).resize(resizeBrowser);resizeBrowser();$(document).keydown(function(n){n.keyCode==13&&n.altKey&&$("#refreshbutton").click()});$(document).ready(function(){var r,u,a,v,n,y,p,w,b,t,d,g,nt,tt,it,f,rt,ut,e;$("#tabs").tabs();$("#scripting-link").hide();$("#plantumlserver-link").hide();$("#email-link").hide();$("#webhook-link").hide();$("#identity-link").hide();$("#logout-link").hide();$("#sidebar").resizable({resize:function(){resizeEditor()},minHeight:350,minWidth:420});$("#login-dialog").dialog({title:"Login",width:275,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#register-dialog").dialog({title:"Register",width:300,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#forgot-dialog").dialog({title:"Forgot Password",width:300,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#reset-dialog").dialog({title:"Reset Password",width:300,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#settings-dialog").dialog({title:"Settings",width:400,autoOpen:!1,modal:!1,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#news-dialog").dialog({title:"News",width:500,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#help-dialog").dialog({title:"Help",width:600,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#scripting-dialog").dialog({title:"Link Maker",width:500,minWidth:500,autoOpen:!1,modal:!0,resizable:!0,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#plantumlserver-dialog").dialog({title:"Change the PlantUML Server",width:500,minWidth:500,autoOpen:!1,modal:!0,resizable:!0,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#sendtoemail-dialog").dialog({title:"Send Diagram To Email",width:300,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#webhook-dialog").dialog({title:"Send Diagram To Web Hook",width:500,minWidth:500,autoOpen:!1,modal:!0,resizable:!0,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#identity-dialog").dialog({title:"Edit Profile",width:300,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},open:function(){$("#identity-email").text(user.email);$("#identity-firstname").val(user.firstname);$("#identity-lastname").val(user.lastname);$("#identity-username").val(user.email);$("#identity-password").val("");$("#identity-password-new1").val("");$("#identity-password-new2").val("")}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#identity-delete-dialog").dialog({title:"Delete Profile",width:300,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#files").dialog({title:"Import / Export",width:450,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#file-menu-new").dialog({title:"New",width:250,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},open:function(){},close:function(){$("#file-menu-new-name").val("");$("#file-menu-new-message").text("")}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#file-menu-open").dialog({title:"Open",width:350,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},open:function(){submitFileMenuOpenLoad()},close:function(){$("file-menu-open-list").html("");$("#file-menu-open-message").text("")}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");$("#file-menu-saveas").dialog({title:"Save As...",width:250,autoOpen:!1,modal:!0,resizable:!1,draggable:!0,show:{effect:"fade",duration:500},hide:{effect:"fade",duration:500},open:function(){},close:function(){$("#file-menu-saveas-name").val("");$("#file-menu-saveas-message").text("")}}).prev(".ui-dialog-titlebar").css("background","#d9d5ff");var o=!1,s="",h=!1,i="",c=!1,l="";q=param();for(k in q)entify(k)=="text"&&(o=!0,s=entify(q[k][0])),entify(k)=="window"&&(h=!0,i=entify(q[k][0])),entify(k)=="token"&&(c=!0,l=entify(q[k][0]));r=localStorage.getItem("plantuml_diagram");n=localStorage.getItem("planttext_default");r===null&&n===null?(localStorage.setItem("planttext_default","planttext_diagram:Default Diagram"),localStorage.setItem("planttext_diagram:Default Diagram","@startuml\r\rBob -> Alice: Hello!\r\r@enduml")):r!=null&&n===null?(localStorage.setItem("planttext_default","planttext_diagram:Default Diagram"),localStorage.setItem("planttext_diagram:Default Diagram",r),localStorage.removeItem("plantuml_diagram")):r===null&&n!=null;typeof Storage!="undefined"&&(u=localStorage.getItem("planttext_message"),u!=null&&(localStorage.setItem("planttext_message",u),localStorage.removeItem("plantuml_diagram")),a=localStorage.getItem("planttext_theme"),a==null&&(localStorage.setItem("planttext_layout","portrait"),localStorage.setItem("planttext_theme","textmate"),localStorage.setItem("planttext_keybinding","ace"),localStorage.setItem("planttext_fontsize","12"),localStorage.setItem("planttext_usesofttabs",!0),localStorage.setItem("planttext_tabsize","2"),localStorage.setItem("planttext_invisibles",!0),localStorage.setItem("planttext_indentguide",!0),localStorage.setItem("planttext_highlightactiveline",!0),localStorage.setItem("planttext_showprintmargin",!0),localStorage.setItem("planttext_showscratch",!1),$("#scratchblock").css("border","0px solid"),localStorage.setItem("planttext_usewrapmode",!1),localStorage.setItem("planttext_syntaxhighlight",!1),localStorage.setItem("planttext_plantumlserver","default")));o?(v=decode64(s),refreshFromSamples(v)):typeof Storage!="undefined"?(n=localStorage.getItem("planttext_default"),n==""?editor.getSession().setValue("@startuml\r\rtitle Empty Diagram\r\r@enduml"):n!=null&&(y=localStorage.getItem(n),fileNameOutput(n),editor.getSession().setValue(y)),p=localStorage.getItem("planttext_layout"),p=="landscape"?($("#layout-landscape").attr("checked","checked"),landscape()):($("#layout-portrait").attr("checked","checked"),portrait()),$("#theme option[value='"+localStorage.getItem("planttext_theme")+"']").attr("selected",!0),t=document.getElementById("theme").options[document.getElementById("theme").selectedIndex].value,editor.setTheme("ace/theme/"+t),w=localStorage.getItem("planttext_keybinding"),$("#keybinding option[value='"+w+"']").attr("selected",!0),t=document.getElementById("keybinding").options[document.getElementById("keybinding").selectedIndex].value,editor.setKeyboardHandler("ace/keyboard/"+t),$("#fontsize option[value='"+localStorage.getItem("planttext_fontsize")+"']").attr("selected",!0),t=document.getElementById("fontsize").options[document.getElementById("fontsize").selectedIndex].value,editor.setFontSize(t+"px"),editor.resize(),b=localStorage.getItem("planttext_usesofttabs"),b=="true"?($("#usesofttabs-checkbox").attr("checked","checked"),editor.session.setUseSoftTabs(!0)):($("#usesofttabs-checkbox").removeAttr("checked"),editor.session.setUseSoftTabs(!1)),$("#tabsize-dropdown option[value='"+localStorage.getItem("planttext_tabsize")+"']").attr("selected",!0),t=document.getElementById("tabsize-dropdown").options[document.getElementById("tabsize-dropdown").selectedIndex].value,editor.session.setTabSize(t),editor.resize(),d=localStorage.getItem("planttext_invisibles"),d=="true"?($("#invisibles").attr("checked","checked"),editor.setShowInvisibles(!0)):($("#invisibles").removeAttr("checked"),editor.setShowInvisibles(!1)),g=localStorage.getItem("planttext_indentguide"),g=="true"?($("#indentguide").attr("checked","checked"),editor.setDisplayIndentGuides(!0)):($("#indentguide").removeAttr("checked"),editor.setDisplayIndentGuides(!1)),localStorage.getItem("planttext_highlightactiveline")=="true"?($("#highlightactiveline-checkbox").attr("checked","checked"),editor.setHighlightActiveLine(!0)):($("#highlightactiveline-checkbox").removeAttr("checked"),editor.setHighlightActiveLine(!1)),localStorage.getItem("planttext_showprintmargin")=="true"?($("#showprintmargin-checkbox").attr("checked","checked"),editor.setShowPrintMargin(!0)):($("#showprintmargin-checkbox").removeAttr("checked"),editor.setShowPrintMargin(!1)),nt=localStorage.getItem("planttext_showscratch"),nt=="true"?($("#showscratch-checkbox").attr("checked","checked"),$('textarea[name="scratch-textarea"]').show(),$("#scratchblock").css("border","1px solid")):($("#showscratch-checkbox").removeAttr("checked"),$('textarea[name="scratch-textarea"]').hide(),$("#scratchblock").css("border","0px solid")),tt=localStorage.getItem("planttext_usewrapmode"),tt=="true"?($("#usewrapmode-checkbox").attr("checked","checked"),editor.session.setUseWrapMode(!0)):($("#usewrapmode-checkbox").removeAttr("checked"),editor.session.setUseWrapMode(!1)),it=localStorage.getItem("planttext_syntaxhighlight"),it=="true"?($("#syntaxhighlighting-checkbox").attr("checked","checked"),editor.getSession().setMode("ace/mode/text")):($("#syntaxhighlighting-checkbox").removeAttr("checked"),editor.getSession().setMode("ace/mode/diagram")),f=localStorage.getItem("planttext_plantumlserver"),document.getElementById("plantumlserver").value=f=="default"?"":f,rt=localStorage.getItem("planttext_webhook"),$("#webhook-hook").val(rt),ut=localStorage.getItem("planttext_webhooktype"),$("#webhook-imagetype option[value='"+ut+"']").attr("selected",!0)):alert("It appears you do not have a local storage capable browser or configuration. Please resolve before trying to use this application");typeof Storage!="undefined"&&(e=localStorage.getItem("planttext_message"),(e===null||e!=news_version)&&i.trim()==""&&openNewsDialog());compress(document.getElementById("description").value);LoadAllSamples();h&&(i=="login"?openLoginDialog():i=="reset"?c&&(resetToken=l,openResetDialog()):i=="register"&&openRegisterDialog());$("#loader").hide()});
